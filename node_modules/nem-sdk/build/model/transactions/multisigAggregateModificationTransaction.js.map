{"version":3,"sources":["../../../src/model/transactions/multisigAggregateModificationTransaction.js"],"names":["prepare","common","tx","network","Error","kp","KeyPair","create","Helpers","fixPrivateKey","privateKey","actualSender","isMultisig","multisigAccount","publicKey","toString","due","Network","data","testnet","id","entity","_construct","modifications","relativeChange","senderPublicKey","timeStamp","createNEMTimeStamp","hasNoRelativeChange","version","getVersion","Objects","TransactionTypes","multisigModification","totalFee","Fees","multisigAggregateModificationTransaction","custom","minCosignatories","length","sort","a","b","modificationType","Address","toAddress","cosignatoryAccount","localeCompare","extendObj","module","exports"],"mappings":"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","file":"multisigAggregateModificationTransaction.js","sourcesContent":["import Network from '../network';\nimport Helpers from '../../utils/helpers';\nimport TransactionTypes from '../transactionTypes';\nimport KeyPair from '../../crypto/keyPair';\nimport Fees from '../fees';\nimport Objects from '../objects';\nimport Address from '../address';\nimport MultisigWrapper from './multisigWrapper';\n\n/**\n * Prepare a multisig aggregate modification transaction object\n *\n * @param {object} common - A common object\n * @param {object} tx - An un-prepared multisigAggregateModificationTransaction object\n * @param {number} network - A network id\n *\n * @return {object} - A [MultisigAggregateModificationTransaction]{@link http://bob.nem.ninja/docs/#multisigAggregateModificationTransaction} object ready for serialization\n */\nlet prepare = function(common, tx, network) {\n    if (!common || !tx || !network) throw new Error('Missing parameter !');\n    let kp = KeyPair.create(Helpers.fixPrivateKey(common.privateKey));\n    let actualSender = tx.isMultisig ? tx.multisigAccount.publicKey : kp.publicKey.toString();\n    let due = network === Network.data.testnet.id ? 60 : 24 * 60;\n    let entity = _construct(actualSender, tx.modifications, tx.relativeChange, tx.isMultisig, due, network);\n    if (tx.isMultisig) {\n        entity = MultisigWrapper(kp.publicKey.toString(), entity, due, network);\n    }\n    return entity;\n}\n\n/**\n * Create a multisignature aggregate modification transaction object\n *\n * @param {string} senderPublicKey - The sender account public key\n * @param {array} modifications - An array of [MultisigCosignatoryModification]{@link http://bob.nem.ninja/docs/#multisigCosignatoryModification} objects  \n * @param {number} relativeChange - The number of signature to add or remove (ex: 1 to add +1 or -1 to remove one)\n * @param {boolean} isMultisig - True if transaction is multisig, false otherwise\n * @param {number} due - The deadline in minutes\n * @param {number} network - A network id\n *\n * @return {object} - A [MultisigAggregateModificationTransaction]{@link http://bob.nem.ninja/docs/#multisigAggregateModificationTransaction} object\n */\nlet _construct = function(senderPublicKey, modifications, relativeChange, isMultisig, due, network) {\n    let timeStamp = Helpers.createNEMTimeStamp();\n    let hasNoRelativeChange = relativeChange === null || relativeChange === 0;\n    let version = hasNoRelativeChange ? Network.getVersion(1, network) : Network.getVersion(2, network);\n    let data = Objects.create(\"commonTransactionPart\")(TransactionTypes.multisigModification, senderPublicKey, timeStamp, due, version);\n    let totalFee = Fees.multisigAggregateModificationTransaction;\n    let custom = {\n        'fee': totalFee,\n        'modifications': modifications,\n        'minCosignatories': {\n            'relativeChange': 0\n        }\n    }\n    // If multisig, it is a modification of an existing contract, otherwise it is a creation\n    if(isMultisig) {\n        // If no relative change, no minCosignatories property\n        if (hasNoRelativeChange) delete custom.minCosignatories;\n        else custom.minCosignatories.relativeChange = relativeChange;\n\n        // Sort modification array\n        if (custom.modifications.length > 1) {\n            custom.modifications.sort((a, b) => {\n                return a.modificationType - b.modificationType || Address.toAddress(a.cosignatoryAccount, network).localeCompare(Address.toAddress(b.cosignatoryAccount, network));\n            });\n        }\n    } else {\n        custom.minCosignatories.relativeChange = relativeChange;\n\n        // Sort modification array by addresses\n        if (custom.modifications.length > 1) {\n            custom.modifications.sort((a, b) => {\n                if (Address.toAddress(a.cosignatoryAccount, network) < Address.toAddress(b.cosignatoryAccount, network)) return -1;\n                if (Address.toAddress(a.cosignatoryAccount, network) > Address.toAddress(b.cosignatoryAccount, network)) return 1;\n                return 0;\n            });\n        }\n    }\n\n    let entity = Helpers.extendObj(data, custom);\n    return entity;\n}\n\nmodule.exports = {\n    prepare\n}"]}